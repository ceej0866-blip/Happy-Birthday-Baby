<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Birthday Cake ðŸŽ‚</title>

<style>
body {
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background: linear-gradient(135deg, #fbd3e9, #bbd2ff);
    font-family: 'Poppins', sans-serif;
    overflow: hidden;
    padding-top: 50px;
}

h1 {
    margin-bottom: 10px;
    color: #ff4da6;
}

.controls {
    margin-bottom: 20px;
}

input {
    padding: 10px;
    border-radius: 20px;
    border: none;
    text-align: center;
    font-size: 16px;
    width: 120px;
}

button {
    padding: 10px 20px;
    border-radius: 20px;
    border: none;
    background: linear-gradient(45deg, #ff4da6, #ff85c1);
    color: white;
    font-weight: bold;
    cursor: pointer;
    margin-left: 5px;
    transition: 0.3s;
}

button:hover {
    transform: scale(1.05);
}

/* Cake */
.cake {
    position: relative;
    width: 320px;
    margin-top: 40px;
}

.layer {
    height: 70px;
    border-radius: 20px;
    background: linear-gradient(#ff85c1, #ff4da6);
    margin: 0px 0;
    box-shadow: 0 8px 15px rgba(0,0,0,0.2);
}

.layer.middle {
    background: linear-gradient(#ffb3d9, #ff66b2);
    width: 260px;
    margin: 0 auto;
}

.layer.top {
    background: linear-gradient(#ffcce6, #ff99cc);
    width: 200px;
    margin: 0 auto;
}

/* Candles container */
.candles {
    position: absolute;
    width: 100%;
    top: -10px; /* touches top of top layer */
    display: flex;
    justify-content: center;
    gap: 8px;
    pointer-events: none;
}

/* Candle */
.candle {
    width: 2px;
    height: 15px;
    background: repeating-linear-gradient(
        45deg,
        white,
        white 5px,
        pink 5px,
        pink 10px
    );
    border-radius: 3px;
    position: relative;
}

/* Flame */
.flame {
    width: 7px;
    height: 15px;
    background: radial-gradient(circle, yellow 0%, orange 60%, red 100%);
    border-radius: 50%;
    position: absolute;
    top: -20px;
    left: -1px;
    animation: flicker 0.15s infinite alternate;
    box-shadow: 0 0 20px orange;
    transition: opacity 1s ease-out, transform 1s ease-out; /* Added */
}

@keyframes flicker {
    from { transform: scale(1); opacity: 1; }
    to { transform: scale(1.2); opacity: 0.7; }
}

/* Confetti */
.confetti {
    position: absolute;
    width: 8px;
    height: 12px;
    opacity: 0.8;
    animation: fall 3s linear infinite;
}

@keyframes fall {
    to {
        transform: translateY(100vh) rotate(360deg);
    }
}

.message {
    margin-top: 15px;
    font-size: 22px;
    font-weight: bold;
    color: #d63384;
    text-align: center;
}
</style>
</head>

<body>

<h1>ðŸŽ‚ Make a Wish!</h1>

<div class="controls">
    <input type="number" id="ageInput" placeholder="Age" min="19" max="19">
    <button onclick="addCandles()">Create Cake</button>
</div>

<div class="cake">
    <div class="candles" id="candleContainer"></div>
    <div class="layer top"></div>
    <div class="layer middle"></div>
    <div class="layer"></div>
</div>

<div class="message" id="status">Blow into your microphone ðŸ’¨</div>

<!-- Birthday music -->
<audio id="birthdaySong" src="birthday-song.mp3"></audio>

<script>
let audioContext, analyser, microphone, dataArray;
let blown = false;

function addCandles() {
    const age = parseInt(document.getElementById("ageInput").value);
    if (!age || age < 19) return alert("Mas matanda ka diyan boss");

    const container = document.getElementById("candleContainer");
    container.innerHTML = "";
    blown = false;
    document.getElementById("status").innerText = "Blow into your microphone ðŸ’¨";

    for (let i = 0; i < age; i++) {
        const candle = document.createElement("div");
        candle.className = "candle";

        const flame = document.createElement("div");
        flame.className = "flame";

        candle.appendChild(flame);
        container.appendChild(candle);
    }

    startMic();
}

function startMic() {
    navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        microphone = audioContext.createMediaStreamSource(stream);
        microphone.connect(analyser);

        analyser.fftSize = 256;
        dataArray = new Uint8Array(analyser.frequencyBinCount);

        detectBlow();
    })
    .catch(() => {
        document.getElementById("status").innerText = "Microphone access denied.";
    });
}

function detectBlow() {
    if (blown) return;

    analyser.getByteFrequencyData(dataArray);

    let volume = 0;
    for (let i = 0; i < dataArray.length; i++) volume += dataArray[i];
    volume /= dataArray.length;

    if (volume > 65) blowOut();
    else requestAnimationFrame(detectBlow);
}

function blowOut() {
    const flames = document.querySelectorAll(".flame");

    flames.forEach(f => {
        // Stop the flicker animation
        f.style.animation = "";

        let flickerTimes = 6; // number of flickers while fading
        let count = 0;

        const flickerInterval = setInterval(() => {
            // Random small scale to mimic flicker
            const scale = 0.8 + Math.random() * 0.4; 
            f.style.transform = `scale(${scale})`;

            // Gradually reduce opacity
            f.style.opacity = 1 - (count / flickerTimes);

            count++;
            if (count > flickerTimes) {
                // Fully fade out
                f.style.opacity = 0;
                f.style.transform = "scale(0.3) translateY(-5px)";
                clearInterval(flickerInterval);
            }
        }, 100); // flicker every 100ms
    });

    // Display a long birthday message instead of song
    const message = `
    ðŸŽ‰ Happy Birthday! ðŸŽ‰  
    Happy birthday, ganda, my girlfriend, my asawa, my ex, my probinsiyana, my bisakol, my Barney - baby, ang dami na nating napagdaanan, pero please always know na kahit ano mangyari, I will always love you the same. Hinding hindi mababawasan or mawawala love ko for you.

I just want to tell you baby na proud na proud ako sayo sobra sobra palagi. Alam ko maraming times na nahihirapan ka kahit hindi mo sinasabi, at minsan wala rin akong magawa para matulungan ka, pero nagawa mo pa rin malagpasan, baby. Alam ko, mahirap mabuhay dito sa mundo, pero sobrang happy ako na nandito ako kasi kasama kita.

Sana hindi mo maramdaman na mag-isa ka o na wala kang katulong dahil always nandito lang ako, baby, kahit hindi mo sabihin. Sobrang excited ako last week pa for birthday mo kasi tatanda ka na, at alam ko, baby, makaka-survive ulit tayo ng another day. Isang malaking blessing na makakasama kita ng one more day ma makakausap ka kahit saglit. I will forever pray for you and celebrate every day of your life, baby. Today, we celebrate you and the blessing it is that you are alive.

Happy birthday sa crush ko! ðŸ˜ŽðŸ˜Ž
    `;
    document.getElementById("status").innerText = message;

    // Show confetti
    createConfetti();

    blown = true;
}

function createConfetti() {
    for (let i = 0; i < 150; i++) {
        const confetti = document.createElement("div");
        confetti.className = "confetti";
        confetti.style.left = Math.random() * 100 + "vw";
        confetti.style.background = `hsl(${Math.random()*360}, 100%, 60%)`;
        confetti.style.animationDuration = (2 + Math.random()*3) + "s";
        document.body.appendChild(confetti);

        setTimeout(() => confetti.remove(), 5000);
    }
}
</script>

</body>
</html>
